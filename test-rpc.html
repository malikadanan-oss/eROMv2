<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />
  <title>eROM@AG • RPC Smoke Test</title>

  <!-- Oswald -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;700&display=swap" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    html,body{margin:0;padding:0;background:#f6f8fb;color:#111827;font-family:'Oswald',Arial,sans-serif}
    .wrap{max-width:720px;margin:24px auto;padding:12px}
    button{font-family:inherit;font-size:1rem;border:none;background:#2563eb;color:#fff;padding:10px 16px;border-radius:10px;cursor:pointer}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:16px;box-shadow:0 2px 10px rgba(0,0,0,.05)}
    .muted{color:#6b7280}
    #app-output{min-height:120px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>eROM@AG • RPC Smoke Test</h1>
    <div class="card">
      <p class="muted">Langkah ini cuma menguji sambungan RPC: fn_admin_check dan fn_create_booking.</p>
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <button id="btnCheckAdmin">Uji Admin Check</button>
        <button id="btnCreateSample">Cipta Tempahan Contoh</button>
      </div>
    </div>

    <div id="app-output" class="wrap"></div>
  </div>

  <!-- Konfigurasi runtime: GANTI NILAI DI SINI -->
  <script>
    window.SUPABASE_URL = "https://aactsdojxtkapfzmtino.supabase.co";
    window.SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFhY3RzZG9qeHRrYXBmem10aW5vIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2NTg5NjYsImV4cCI6MjA3NjIzNDk2Nn0.pbvTH5Z2kVMEP3oEhpelpn6l48jkncRwUOfY5l6-GaM";
  </script>

  <script type="module">
    import { supa } from './src/api/supabaseClient.js';

    const Toast = Swal.mixin({ toast:true, position:'top', timer:2200, showConfirmButton:false, timerProgressBar:true });
    const $ = (id) => document.getElementById(id);

    $('btnCheckAdmin').addEventListener('click', async () => {
      try{
        const { data, error } = await supa.rpc('fn_admin_check', { pw: 'ppdag' });
        if (error) throw error;
        if (data === true) Toast.fire({ icon:'success', title:'Admin OK' });
        else Toast.fire({ icon:'error', title:'Admin gagal' });
      }catch(err){
        Swal.fire('Ralat', err.message || String(err), 'error');
      }
    });

    $('btnCreateSample').addEventListener('click', async () => {
      try{
        // guna tarikh esok jam 09:00–10:00, bilik & medan lain sekadar contoh
        const esok = new Date(Date.now() + 24*60*60*1000).toISOString().slice(0,10);
        const args = {
          p_room: 'Bilik Mesyuarat 1',
          p_date: esok,
          p_start: '09:00',
          p_end: '10:00',
          p_category: 'Ujian',
          p_note: 'Smoke test',
          p_sektor: 'Sektor Perancangan',
          p_nama: 'En. Saifullah Bin Abdul Wahab'
        };
        const { data, error } = await supa.rpc('fn_create_booking', args);
        if (error) throw error;
        if (data?.ok) {
          Toast.fire({ icon:'success', title:'Tempahan contoh berjaya' });
        } else {
          Swal.fire('Gagal', data?.error || 'Tidak diketahui', 'error');
        }
      }catch(err){
        Swal.fire('Ralat', err.message || String(err), 'error');
      }
    });
  </script>
</body>
</html>
